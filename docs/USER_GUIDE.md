# LLMctl 用户手册

**版本**: v2.2.4 | **更新日期**: 2025-10-31

---

## 📖 简介

LLMctl 是一个强大的 LLM 提供商、Token 和会话管理桌面应用，帮助您轻松管理多个 AI CLI 工具（Claude Code、Codex、Gemini、Qoder）的配置和使用。

### 核心特性

- 🔐 **用户认证系统** - JWT认证、邮箱验证注册、多用户数据隔离
- 🏗️ **配置分离架构** - Provider 支持多个 CLI 工具，配置灵活可扩展
- 🔑 **智能Token管理** - 多Token轮询、健康检查、自动切换
- 💻 **强大终端功能** - 多标签页、全屏模式、快捷键、外部终端支持
- 🔒 **企业级加密** - AES-256-GCM加密存储Token
- 🔔 **实时通知系统** - SSE推送、通知中心管理

### 系统要求

- **操作系统**: Windows 10/11, macOS 10.15+, Ubuntu 20.04+
- **内存**: 4GB RAM（推荐8GB）
- **磁盘空间**: 500MB可用空间

---

## 🚀 快速开始

### 第一步：用户登录

1. **启动应用**后显示登录页面
2. **首次使用**：
   - 点击"注册"创建新账户（需要QQ/163邮箱验证）
3. **登录成功**后进入主应用

> **提示**: 支持用户名或邮箱地址登录

### 第二步：创建 Provider

1. 点击左侧菜单 **Providers**
2. 点击 **"Add Provider"** 按钮
3. 填写Provider信息：

   | 字段 | 说明 | 示例 |
   |------|------|------|
   | 名称 | Provider的显示名称 | `My AI Assistant` |
   | 类型 | 选择CLI工具（可多选） | `Claude Code`, `Codex` |
   | 描述 | 备注信息（可选） | `生产环境使用` |

4. **根据选中的类型填写对应配置**：
   - **Claude Code**: Base URL、Model Name、Max Tokens、Temperature
   - **Codex**: Config.toml 内容（后端自动生成 auth.json）
   - **Gemini/Qoder**: 暂未适配

5. 点击 **"确认"** 保存

> **v2.2.0 新特性**: 一个 Provider 可以同时支持多个 CLI 工具，根据需要灵活配置

### 第三步：添加 Token (API Keys)

1. 点击左侧菜单 **API Keys**
2. 选择要添加Token的Provider
3. 点击 **"Add Token"** 按钮
4. 填写Token信息：

   | 字段 | 说明 |
   |------|------|
   | Token值 | 完整的API密钥 |
   | 权重 | 用于加权轮询策略（默认1） |
   | 启用状态 | 是否启用此Token |

5. 点击 **"确认"** 保存

> **安全提示**: Token会被加密存储，界面只显示前4位和后4位

### 第四步：启动会话

1. 点击左侧菜单 **Sessions**
2. 点击 **"Start Session"** 按钮
3. 配置会话：
   - **Provider**: 选择要使用的Provider
   - **CLI命令**: 选择CLI类型（claude、codex、gemini、qoder）
   - **工作目录**: 选择CLI进程的工作目录（点击📁按钮选择文件夹）
4. 点击 **"确认"** 启动
5. 系统会自动：
   - 根据轮询策略选择Token
   - 设置环境变量（包括 CODEX_HOME 等）
   - 启动CLI进程
   - 打开终端标签页

---

## 💡 核心功能

### Provider 管理

**查看列表**
- Provider列表显示名称、支持的CLI类型、描述、状态

**编辑Provider**
- 点击"编辑"按钮修改配置
- 可以添加或删除CLI类型
- 修改后立即生效

**启用/禁用**
- 点击状态开关控制Provider启用状态
- 禁用后不会被用于新会话

**删除Provider**
- 点击"删除"按钮删除Provider
- **注意**: 会同时删除关联的Token和会话

---

### Token 管理

**Token轮询策略** (在Settings中配置)

| 策略 | 说明 | 适用场景 |
|------|------|----------|
| **Round Robin** | 按顺序轮询 | Token性能相近 |
| **Weighted** | 按权重随机选择 | Token有配额等级差异 |
| **Random** | 完全随机 | 简单负载分散 |
| **Least Used** | 选择最少使用的 | 最大化Token利用率 |

**Token健康检查**
- 系统自动检测Token错误并标记为不健康
- 支持的错误模式：余额不足、速率限制、认证失败、无效密钥等
- Token失效时自动切换到健康Token

**手动切换Token**
- 终端标签栏有"切换 Token"按钮
- 支持手动触发Token切换（适用于自动检测未捕获的错误）

---

### MCP 服务器管理

**什么是 MCP？**

MCP (Model Context Protocol) 是一个开放协议，允许 AI 工具通过外部服务器获取增强能力，例如：
- 访问文件系统
- 连接数据库
- 调用 API
- 执行 Git 操作

> **v2.2.4 新特性**: 全局 MCP 配置，所有会话自动应用已启用的 MCP 服务器

#### 查看模板库

1. 点击左侧菜单 **MCP Servers**
2. 点击 **"MCP 模板库"** 按钮
3. 浏览内置的 MCP 模板，按类别分组：
   - **文件系统** - memory (内存存储)、sqlite (SQLite数据库)
   - **API & 服务** - fetch (HTTP请求)、context7 (文档搜索)、brave-search (搜索引擎)
   - **开发工具** - git (Git操作)、gitlab (GitLab API)

#### 从模板创建 MCP

1. 在模板库中找到需要的 MCP 模板
2. 点击模板卡片的 **"使用模板"** 按钮
3. **自定义配置**（可选）：
   - 修改名称和描述
   - 添加/删除命令参数
   - 配置环境变量（例如 API Key）
   - 选择图标
4. 点击 **"创建"** 完成

> **提示**: 包含 KEY、TOKEN、PASSWORD、SECRET 的环境变量会自动使用密码输入框

#### 手动创建自定义 MCP

1. 在 MCP Servers 页面点击 **"新建 MCP"** 按钮
2. 填写基本信息：

   | 字段 | 说明 | 示例 |
   |------|------|------|
   | 名称 | MCP 服务器名称 | `my-filesystem` |
   | 描述 | 功能说明 | `访问项目文件系统` |
   | 命令 | 执行命令 | `npx` |
   | 参数 | 命令参数（可多个） | `-y`, `@modelcontextprotocol/server-filesystem` |
   | 环境变量 | 键值对（可多个） | `PATH=/home/user` |
   | 图标 | 选择图标（可选） | 文件夹 📁 |

3. 点击 **"➕ 添加参数"** 或 **"➕ 添加环境变量"** 添加更多配置
4. 点击 **"确认"** 保存

#### 管理 MCP 状态

**启用/禁用**
- 点击 MCP 名称旁的状态标签或操作栏的"启用"/"禁用"按钮
- 已启用：🟢 绿色标签，自动应用到所有会话
- 未启用：🔘 灰色标签，不会被加载

> **实时排序**: 启用/禁用操作后，列表会自动重排（已启用优先显示）

**编辑 MCP**
- 点击"编辑"按钮修改配置
- 可以添加/删除参数和环境变量
- 修改后对新会话生效

**删除 MCP**
- 点击"删除"按钮删除 MCP 服务器
- 系统会提示确认
- **注意**: 用户创建的 MCP 可以删除，模板 MCP 不允许删除

#### 批量操作

**批量启用/禁用**
1. 勾选要操作的 MCP 服务器（多选）
2. 点击 **"批量启用"** 或 **"批量禁用"** 按钮
3. 系统会提示确认，点击确定即可

**批量删除**
1. 勾选要删除的 MCP 服务器
2. 点击 **"批量删除"** 按钮
3. 系统会显示详细提示，确认后删除

> **安全机制**: 批量删除不会删除模板 MCP，只删除用户创建的 MCP

#### 图标系统

为 MCP 服务器选择合适的图标，方便快速识别：

| 图标 | 含义 | 适用场景 |
|------|------|----------|
| 📁 文件夹 | 文件系统 | filesystem、memory 等 |
| 💾 数据库 | 数据库连接 | sqlite、mysql、postgres 等 |
| 🔗 GitHub | 版本控制 | git、gitlab、github 等 |
| 🌍 全局 | 通用服务 | 通用 API、工具 |
| ☁️ 云服务 | 云API | context7、brave-search 等 |
| 🌿 分支 | 分支管理 | 多分支操作 |
| 🤖 机器人 | 自动化 | 自动化任务 |
| 💡 灯泡 | 智能功能 | AI增强功能 |

#### 最佳实践

1. **命名规范**: 使用小写字母和连字符（例如 `my-custom-mcp`）
2. **描述清晰**: 在描述中说明 MCP 的功能和用途
3. **环境变量加密**: 系统自动加密存储包含敏感关键字的环境变量
4. **定期检查**: 定期禁用不需要的 MCP 以提升性能
5. **测试验证**: 创建后在会话中测试 MCP 是否正常工作

---

### 会话管理

**会话状态**

| 状态 | 说明 | 颜色 |
|------|------|------|
| Active | 进程正在运行 | 🟢 绿色 |
| Inactive | 进程已暂停 | 🟡 黄色 |

**会话信息**
- 会话名称格式：`Provider名 - 项目名 #序号`
- 自动从工作目录提取项目名
- 显示相对时间（刚刚、N分钟前）和持续时间

**快捷操作**
- **双击行**: 打开终端
- **右键菜单**:
  - 打开终端/重新启动
  - 复制会话ID
  - 复制工作目录
  - 在文件管理器中打开
  - 终止/删除会话

**重启会话**
- Token失效时系统会提示重启
- 自动删除旧会话，创建新会话
- 使用健康的Token，继承原工作目录

---

### 终端功能

**多终端并发**
- 支持同时打开多个终端标签页
- 每个终端独立管理，互不干扰
- 标签页显示会话信息（Provider、项目名）

**快捷键**
- `Ctrl+1/2/3`: 快速切换终端标签页（最多支持9个）
- `Ctrl+W`: 关闭当前终端
- `F11`: 切换全屏模式
- `ESC`: 退出全屏
- `Ctrl+滚轮`: 动态调整字体大小（8-30px）

**复制粘贴**
- `Ctrl+C` / `Cmd+C`: 复制选中文本
- `Ctrl+V` / `Cmd+V`: 粘贴剪贴板内容
- **右键点击**: 直接粘贴剪贴板内容
- **智能Ctrl+C**: 有选中文本时复制，无选中文本时发送中断信号

**外部终端**
- 点击"外部终端"按钮一键切换到系统原生终端
- 自动切换工作目录并执行命令
- 支持 Windows CMD、macOS Terminal、Linux Terminal

**自动执行命令**
- 终端打开后自动执行会话配置的命令
- 无需手动输入，打开即用

---

### 通知系统

**查看通知**
- 点击顶部导航栏的通知图标（🔔）查看未读通知
- 未读数量实时显示
- 支持按类型和优先级过滤

**通知类型**
- 💬 系统通知：应用更新、系统维护
- 🖥️ 会话提醒：会话启动、终止、状态变更
- 📊 统计报告：使用统计、Token消耗报告
- ⚠️ 警告信息：Token即将耗尽、配额预警
- ❌ 错误提醒：API调用失败、连接异常

**批量操作**
- 批量标记已读
- 批量删除
- 全选/取消选择

---

### 用户资料管理

点击顶部导航栏用户头像 → "个人信息"

**可以管理**：
- 修改昵称（显示名称）
- 绑定/更新邮箱
- 上传头像（支持JPG/PNG/GIF，2MB以内）
- 修改密码（需邮箱验证码验证）

---

### 系统设置

点击左侧菜单 **Settings**

**可配置项**：
- **Token轮询策略**: 选择全局Token选择策略
- **语言**: 中文/English
- **系统托盘**: 最小化到托盘
- **数据管理**: 清理日志、缓存、重置数据

---

## ❓ 常见问题

**Q: 忘记密码怎么办？**
> A: 登录页面点击"忘记密码？"链接，按提示通过邮箱验证重置密码。前提是已绑定邮箱。

**Q: Token显示"不健康"怎么办？**
> A: 可能原因：余额不足、Token过期、网络问题。解决：充值/更换Token，检查网络，或在Token管理中手动测试Token。

**Q: 如何配置多个CLI工具？**
> A: 创建Provider时勾选多个类型，分别填写对应的配置项。一个Provider可以同时支持Claude Code和Codex。

**Q: Codex配置需要填写什么？**
> A: 只需填写 config.toml 内容，后端会自动生成 auth.json 并注入Token。系统会自动设置 CODEX_HOME 环境变量指向项目目录。

**Q: 如何切换到外部终端？**
> A: 在终端标签栏点击"外部终端"按钮。注意：系统无法自动检测外部终端关闭，需手动管理。

**Q: 会话重启后历史记录会丢失吗？**
> A: 是的。重启会话会删除旧会话记录，创建全新会话。如需保留历史，请先备份。

**Q: 如何备份配置？**
> A: Settings → "Export Config" 导出JSON配置文件，或直接备份MySQL数据库。

**Q: 收不到邮箱验证码？**
> A: 检查：1) 邮箱地址是否正确；2) 垃圾邮件箱；3) 仅支持QQ/163邮箱；4) 邮件服务器配置是否正常。

**Q: 如何添加自定义Provider？**
> A: 当前版本支持Claude Code、Codex、Gemini、Qoder四种类型。自定义Provider功能在规划中。

**Q: 数据存储在哪里？是否安全？**
> A: 数据存储在本地MySQL数据库，不会上传到外部服务器。Token采用AES-256-GCM加密存储，密码使用BCrypt加密。

**Q: 如何使用 MCP 服务器？**
> A: 点击左侧菜单 MCP Servers → 点击"MCP 模板库"浏览内置模板 → 选择模板点击"使用模板"→ 配置后点击"创建"。MCP 启用后会自动应用到所有新会话。

**Q: MCP 服务器有什么用？**
> A: MCP 可以为 AI 工具添加额外能力，例如：访问文件系统（memory）、查询数据库（sqlite）、发送 HTTP 请求（fetch）、执行 Git 操作（git）、搜索文档（context7、brave-search）等。

**Q: 如何禁用不需要的 MCP？**
> A: 在 MCP Servers 页面找到要禁用的 MCP，点击"禁用"按钮即可。禁用后不会被加载到新会话中，已启动的会话需要重启才能生效。

---

## 🆘 获取帮助

### 应用内帮助

- 点击顶部导航栏 **Help** 按钮查看完整帮助文档
- 支持搜索和分类查看
- 包含快捷键一览表和常见问题

### 官方资源

- **GitHub仓库**: https://github.com/3202336152/llmctl-desktop
- **问题反馈**: https://github.com/3202336152/llmctl-desktop/issues
- **更新日志**: 查看 CHANGELOG.md 或 GitHub Releases

### 报告问题

提交Issue时请包含：
- 操作系统和版本
- LLMctl版本（当前：v2.2.4）
- 问题详细描述和复现步骤
- 错误日志（位置：`用户目录/AppData/Roaming/LLMctl/logs/`）

---

## 🔧 故障排查

**应用无法启动**
- 检查MySQL服务是否运行
- 检查端口8080是否被占用
- 查看日志文件定位问题

**数据库连接错误**
- 确认MySQL已启动并正确配置
- 验证数据库用户名和密码
- 检查数据库 `llmctl` 是否存在

**Token测试失败**
- 验证Token格式是否正确
- 检查网络连接
- 确认Base URL配置正确
- 在Provider官网验证Token有效性

**终端无法打开**
- 检查工作目录是否存在
- 确认选择的Provider有健康的Token
- 查看会话状态是否为Active

**界面显示异常**
- 清除应用缓存（Settings → Clear Cache）
- 调整窗口大小至至少1024x768

---

## 📝 快捷键一览

| 快捷键 | 功能 | 适用页面 |
|--------|------|----------|
| `Ctrl+K` | 打开命令面板 | 全局 |
| `Ctrl+1/2/3` | 切换终端标签页 | Terminals |
| `Ctrl+W` | 关闭当前终端 | Terminals |
| `F11` | 切换全屏模式 | Terminals |
| `ESC` | 退出全屏 | Terminals |
| `Ctrl+滚轮` | 调整字体大小 | Terminals |
| `Ctrl+C` | 复制/中断 | Terminals |
| `Ctrl+V` | 粘贴 | Terminals |
| `Ctrl+Enter` | 换行（不执行命令） | Terminals |

---

## 📚 术语表

| 术语 | 解释 |
|------|------|
| **Provider** | LLM服务配置，可以支持多个CLI工具 |
| **Token** | API访问密钥，用于身份验证和计费 |
| **Session** | CLI会话，代表一个运行中的进程 |
| **CLI类型** | 命令行工具类型（claude code、codex、gemini、qoder） |
| **轮询策略** | Token选择策略，决定如何选择Token |
| **健康检查** | 验证Token可用性的自动测试 |
| **脱敏显示** | 隐藏Token敏感部分，仅显示前后几位 |
| **配置分离** | Provider核心信息与CLI专用配置独立存储 |
| **MCP** | Model Context Protocol，为AI工具提供外部能力的开放协议 |
| **MCP 服务器** | 实现 MCP 协议的服务，为 AI 工具提供特定功能（文件系统、数据库、API等） |
| **MCP 模板** | 预配置的 MCP 服务器模板，开箱即用或需少量配置 |
| **全局配置** | 统一管理的配置方式，所有会话自动应用 |

---

**文档版本**: v2.2.4
**最后更新**: 2025-10-31
**适用版本**: LLMctl 2.2.4及以上

如有任何问题或建议，欢迎通过应用内Help按钮查看详细文档，或访问GitHub Issues反馈！
